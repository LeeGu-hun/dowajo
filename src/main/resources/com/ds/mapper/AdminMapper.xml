<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ds.mapper.AdminMapper">  	
	
  <resultMap type="com.ds.domain.UserVO" id="userMap">
    <id property="user_no" column="user_no"/>
    <result property="user_id" column="user_id"/>
    <result property="user_pw" column="user_pw"/>
    <result property="user_name" column="user_name"/>
    <result property="user_depart" column="user_depart"/>
    <result property="user_mobile" column="user_mobile"/>
    <result property="user_email" column="user_email"/>
    <result property="regdate" column="regdate"/>
    <collection property="authList" resultMap="authMap">
    </collection> 
  </resultMap>
  
  <resultMap type="com.ds.domain.AuthVO" id="authMap">
    <result property="user_no" column="user_no"/>
    <result property="user_auth" column="user_auth"/>
  </resultMap>
  
	<select id="checkLogin" resultMap="userMap">
		SELECT
		u.user_no, user_id, user_pw, user_name, user_depart, user_mobile, user_email,
		regdate, user_auth
		FROM
		ds_user u LEFT OUTER JOIN ds_auth a on u.user_no = a.user_no
		WHERE user_id = #{id}
	</select>
	
	<select id="lecutureList" resultType="com.ds.domain.LectureVO">
	select lecture_no, lecture_name, lecture_twitchid from ds_lecture l natural join ds_class_list c
	where c.user_no=#{user_no}
	</select>
	
	<insert id="admin_regist">
		insert into ds_user (user_no,user_id,user_pw,user_name,user_depart,user_mobile,user_email,regdate)
		values (ds_user_seq.nextval, #{user_id}, #{user_pw}, #{user_name}, '동성', #{user_mobile}, #{user_email}, sysdate)
		<selectKey resultType="long" keyProperty="user_no"
			order="AFTER">
			SELECT ds_user_seq.currval from dual
		</selectKey>
	</insert>	
	
	<insert id="admin_registAuth">
		insert into ds_auth values (#{user_no},'ROLE_ADMIN')
	</insert>
	
</mapper>
