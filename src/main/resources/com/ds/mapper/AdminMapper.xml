<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ds.mapper.AdminMapper">  	
	
  <resultMap type="com.ds.domain.UserVO" id="userMap">
    <id property="user_no" column="user_no"/>
    <result property="user_id" column="user_id"/>
    <result property="user_pw" column="user_pw"/>
    <result property="user_name" column="user_name"/>
    <result property="user_depart" column="user_depart"/>
    <result property="user_mobile" column="user_mobile"/>
    <result property="user_email" column="user_email"/>
    <result property="regdate" column="regdate"/>
    <collection property="authList" resultMap="authMap">
    </collection> 
  </resultMap>
  
  <resultMap type="com.ds.domain.AuthVO" id="authMap">
    <result property="user_no" column="user_no"/>
    <result property="user_auth" column="user_auth"/>
  </resultMap>
  
   <resultMap type="com.ds.domain.QuestionsVO" id="queMap">
  		<id property="que_no" column="que_no"/>
  		<result property="que_writer" column="que_writer"/>
  		<result property="que_title" column="que_title"/>
  		<result property="que_content" column="que_content"/>
  		<result property="que_date" column="que_date"/>
  	</resultMap>
  		
  	<select id="duplicateId" resultType="string">
		SELECT user_id FROM ds_user
		WHERE user_id = #{user_id}
	</select>
	
	<insert id="admin_regist">
		insert into ds_user (user_no,user_id,user_pw,user_name,user_depart,user_mobile,user_email,regdate)
		values (ds_user_seq.nextval, #{user_id}, #{user_pw}, #{user_name}, '동성', #{user_mobile}, #{user_email}, sysdate)
		<selectKey resultType="long" keyProperty="user_no"
			order="AFTER">
			SELECT ds_user_seq.currval from dual
		</selectKey>
	</insert>	
	
	<insert id="admin_registAuth">
		insert into ds_auth values (#{user_no},'ROLE_ADMIN')
	</insert>
	
	<insert id="teacher_regist">
		insert into ds_user (user_no,user_id,user_pw,user_name,user_depart,user_mobile,user_email,regdate)
		values (ds_user_seq.nextval, #{user_id}, #{user_pw}, #{user_name}, #{user_depart}, #{user_mobile}, #{user_email}, sysdate)
		<selectKey resultType="long" keyProperty="user_no"
			order="AFTER">
			SELECT ds_user_seq.currval from dual
		</selectKey>
	</insert>	
	
	<insert id="teacher_registAuth">
		insert into ds_auth values (#{user_no},'ROLE_TEACHER')
	</insert>
	

	<sql id="criteria">
		<trim prefix="(" suffix=") AND " prefixOverrides="OR">
			<foreach item='type' collection="typeArr">
			</foreach>
		</trim>
	</sql>
	
	<select id="getTotalCount" resultType="int">
		<![CDATA[ 
		select count(*) from ds_qa where 
		]]>
		<include refid="criteria"></include>
		<![CDATA[ 
		qa_no > 0
		]]>
	</select>
	
	<select id="getQueList" resultType="com.ds.domain.QuestionsVO">
	<![CDATA[
	select qa_no, qa_writer, qa_title,qa_date 
	from (select rownum rn, qa_no, qa_writer, qa_title,qa_date from ds_qa where
	]]>	
  
  <include refid="criteria"></include>
  
  <![CDATA[
  rownum<= #{pageNum} * #{amount})
  where rn>(#{pageNum}-1)*#{amount}  
  order by qa_no
  ]]>
	</select>
	
</mapper>
